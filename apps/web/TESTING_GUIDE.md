# 인증 시스템 테스트 가이드

## 🧪 테스트 체크리스트

### 사전 준비
- [ ] `.env.local` 파일에 Supabase 환경 변수 설정
- [ ] `npm run dev` 실행
- [ ] Supabase Dashboard 준비 (인증 확인용)

---

## 1️⃣ 회원가입 테스트

### 테스트 URL
`http://localhost:3000/auth/signup`

### 테스트 시나리오

#### ✅ 성공 케이스
1. 유효한 이메일 입력 (예: `test@example.com`)
2. 이름 입력 (예: `홍길동`)
3. 비밀번호 6자 이상 입력
4. 비밀번호 확인 일치하게 입력
5. "회원가입" 버튼 클릭
6. **예상 결과**: 
   - 성공 메시지 표시
   - 2초 후 로그인 페이지로 리다이렉트

#### ❌ 실패 케이스
- [ ] 비밀번호 6자 미만 입력 → "비밀번호는 최소 6자 이상이어야 합니다." 에러
- [ ] 비밀번호 불일치 → "비밀번호가 일치하지 않습니다." 에러
- [ ] 이미 존재하는 이메일 → Supabase 에러 메시지 표시
- [ ] 빈 필드 → HTML5 validation 에러

---

## 2️⃣ 로그인 테스트

### 테스트 URL
`http://localhost:3000/auth/login`

### 테스트 시나리오

#### ✅ 성공 케이스
1. 가입한 이메일 입력
2. 올바른 비밀번호 입력
3. "로그인" 버튼 클릭
4. **예상 결과**:
   - 성공 메시지 표시
   - `/demo` 페이지로 리다이렉트
   - 우측 상단에 사용자 메뉴 표시

#### ❌ 실패 케이스
- [ ] 잘못된 이메일 → "Invalid login credentials" 에러
- [ ] 잘못된 비밀번호 → "Invalid login credentials" 에러
- [ ] 빈 필드 → HTML5 validation 에러

---

## 3️⃣ 세션 유지 테스트

### 테스트 시나리오

1. 로그인 성공 후 `/demo` 페이지 접속
2. 브라우저 새로고침 (F5)
3. **예상 결과**: 
   - 로그인 상태 유지됨
   - 사용자 정보 여전히 표시됨

4. 브라우저 닫기
5. 브라우저 다시 열기
6. `http://localhost:3000/demo` 접속
7. **예상 결과**:
   - 로그인 상태 유지됨 (쿠키 덕분에)

---

## 4️⃣ 로그아웃 테스트

### 테스트 시나리오

1. 로그인 상태에서 우측 상단 사용자 메뉴 클릭
2. "로그아웃" 버튼 클릭
3. **예상 결과**:
   - `/auth/login` 페이지로 리다이렉트
   - 사용자 메뉴 사라짐

4. `/demo` 페이지 직접 접속 시도
5. **예상 결과**:
   - `/auth/login?redirectTo=/demo`로 리다이렉트

---

## 5️⃣ 비밀번호 재설정 테스트

### 테스트 URL
`http://localhost:3000/auth/reset-password`

### 테스트 시나리오

1. 가입한 이메일 입력
2. "재설정 링크 전송" 버튼 클릭
3. **예상 결과**:
   - 성공 메시지 표시
   - Supabase Dashboard > Authentication > Users에서 이메일 확인 가능

4. 이메일에서 재설정 링크 클릭 (개발 중에는 Dashboard에서 복사)
5. **예상 결과**:
   - `/auth/update-password` 페이지로 이동

6. 새 비밀번호 입력 (6자 이상)
7. 비밀번호 확인 입력 (일치하게)
8. "비밀번호 변경" 버튼 클릭
9. **예상 결과**:
   - 성공 메시지 표시
   - 2초 후 로그인 페이지로 리다이렉트

10. 새 비밀번호로 로그인 시도
11. **예상 결과**: 로그인 성공

---

## 6️⃣ 라우트 보호 테스트

### 테스트 시나리오

#### 로그아웃 상태에서

1. `/demo` 직접 접속 시도
2. **예상 결과**: `/auth/login?redirectTo=/demo`로 리다이렉트

3. `/` 접속
4. **예상 결과**: 정상 접속 (홈페이지는 보호되지 않음)

#### 로그인 상태에서

1. `/auth/login` 접속 시도
2. **예상 결과**: `/demo`로 리다이렉트

3. `/auth/signup` 접속 시도
4. **예상 결과**: `/demo`로 리다이렉트

---

## 7️⃣ API 인증 테스트

### 테스트 시나리오

1. 브라우저 개발자 도구 열기 (F12)
2. Console 탭으로 이동
3. 다음 명령어 실행:

```javascript
// 로그인 상태에서
fetch('/api/auth/user')
  .then(res => res.json())
  .then(data => console.log(data))

// 예상 결과: { user: {...}, authenticated: true }
```

4. 로그아웃 후 동일한 명령어 실행
5. **예상 결과**: `{ user: null, authenticated: false }`

---

## 8️⃣ 사용자 메뉴 테스트

### 테스트 시나리오

1. 로그인 상태에서 `/demo` 페이지 접속
2. 우측 상단 사용자 메뉴 확인
3. **예상 결과**:
   - 이메일 첫 글자로 만든 아바타 표시
   - 이메일 주소 표시

4. 사용자 메뉴 클릭
5. **예상 결과**:
   - 드롭다운 메뉴 표시
   - 사용자 이름 또는 이메일 표시
   - "로그아웃" 버튼 표시

6. 메뉴 외부 클릭
7. **예상 결과**: 드롭다운 닫힘

---

## 9️⃣ 이메일 확인 테스트

### Supabase Dashboard에서 테스트

1. Supabase Dashboard 열기
2. Authentication > Users 이동
3. 가입한 사용자 찾기
4. "Send confirmation email" 클릭 (필요시)
5. 이메일 확인 또는 Dashboard에서 확인 링크 복사
6. 확인 링크 클릭
7. **예상 결과**: 
   - `/api/auth/callback?code=...` 경유
   - `/demo` 페이지로 최종 리다이렉트
   - 로그인 상태

---

## 🔟 브라우저 호환성 테스트

### 테스트할 브라우저
- [ ] Chrome/Edge
- [ ] Firefox
- [ ] Safari
- [ ] Mobile Safari (iOS)
- [ ] Chrome Mobile (Android)

### 각 브라우저에서 확인
1. 회원가입 → 로그인 → 로그아웃 흐름
2. 쿠키 저장 확인
3. 세션 유지 확인
4. 페이지 새로고침 후 상태 유지

---

## 📊 성능 테스트

### 테스트 항목
- [ ] 로그인 응답 시간 (< 1초)
- [ ] 세션 확인 시간 (< 500ms)
- [ ] 페이지 로드 시 인증 체크 (< 200ms)

---

## 🐛 버그 리포트 템플릿

문제 발견 시 다음 정보를 기록하세요:

```markdown
### 문제 설명
[문제에 대한 명확한 설명]

### 재현 방법
1. [첫 번째 단계]
2. [두 번째 단계]
3. [...]

### 예상 동작
[무엇이 일어날 것으로 예상했는지]

### 실제 동작
[실제로 무엇이 일어났는지]

### 환경
- 브라우저: [예: Chrome 120]
- OS: [예: macOS 14]
- Node 버전: [예: 20.10.0]

### 스크린샷
[가능하면 첨부]

### 콘솔 에러
[브라우저 콘솔의 에러 메시지]
```

---

## ✅ 모든 테스트 통과 시

축하합니다! 인증 시스템이 정상적으로 작동합니다. 🎉

다음 단계:
1. 프로덕션 환경 변수 설정
2. Supabase RLS 정책 설정
3. 이메일 템플릿 커스터마이징
4. 프로덕션 배포

---

## 🆘 문제 해결

### 로그인 후에도 사용자 정보가 null
- `AuthProvider`가 `app/layout.tsx`에 있는지 확인
- 브라우저 콘솔 에러 확인
- 쿠키 설정 확인

### "Invalid API key" 에러
- `.env.local` 파일 확인
- 환경 변수 이름 확인 (`NEXT_PUBLIC_` 접두사)
- 서버 재시작 (`npm run dev` 다시 실행)

### 이메일이 전송되지 않음
- Supabase Dashboard > Authentication > Email Templates 확인
- SMTP 설정 확인 (프로덕션의 경우)
- 개발 중에는 Dashboard에서 확인 링크 직접 복사

### 세션이 자동으로 만료됨
- `middleware.ts` 설정 확인
- Supabase JWT 만료 시간 확인
- 브라우저 쿠키 설정 확인

---

## 📝 테스트 로그 예시

```
[2024-01-15 10:00:00] ✅ 회원가입 성공 (test@example.com)
[2024-01-15 10:01:00] ✅ 로그인 성공
[2024-01-15 10:02:00] ✅ 세션 유지 확인
[2024-01-15 10:03:00] ✅ 로그아웃 성공
[2024-01-15 10:04:00] ✅ 라우트 보호 동작
[2024-01-15 10:05:00] ✅ 비밀번호 재설정 이메일 전송
[2024-01-15 10:06:00] ✅ 비밀번호 변경 성공
[2024-01-15 10:07:00] ✅ 새 비밀번호로 로그인 성공

모든 테스트 통과! 🎉
```
